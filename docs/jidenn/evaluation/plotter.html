<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>jidenn.evaluation.plotter API documentation</title>
<meta name="description" content="Module for plotting the results of the evaluation and plotting the training history.
The ploting is done by subsclassing the â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>jidenn.evaluation.plotter</code></h1>
</header>
<section id="section-intro">
<p>Module for plotting the results of the evaluation and plotting the training history.
The ploting is done by subsclassing the <code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code> class,
with the <code><a title="jidenn.evaluation.plotter.ValidationFigure.get_fig" href="#jidenn.evaluation.plotter.ValidationFigure.get_fig">ValidationFigure.get_fig()</a></code> method being the main method.</p>
<p>Each figure is saved as a png file, as a csv file, and saved to tensorboard.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Module for plotting the results of the evaluation and plotting the training history.
The ploting is done by subsclassing the `jidenn.evaluation.plotter.ValidationFigure` class,
with the `jidenn.evaluation.plotter.ValidationFigure.get_fig` method being the main method.

Each figure is saved as a png file, as a csv file, and saved to tensorboard.
&#34;&#34;&#34;
from logging import Logger
import pandas as pd
import os
import matplotlib.pyplot as plt
import seaborn as sns
from abc import abstractmethod
import tensorflow as tf
import numpy as np
from sklearn.metrics import roc_curve, confusion_matrix, auc
from io import BytesIO
from typing import List, Union, Dict, Tuple


sns.set_theme(style=&#34;ticks&#34;)


class ValidationFigure:
    &#34;&#34;&#34;Base class for validation figures.

    Only the `get_fig` method needs to be implemented.

    Args:
        df (pd.DataFrame): The dataframe containing the data.
        name (str, optional): The name of the figure. Defaults to &#39;fig&#39;.
        class_names (List[str], optional): The names of the classes. Defaults to None.

    &#34;&#34;&#34;

    def __init__(self, df: pd.DataFrame, name: str = &#39;fig&#39;, class_names: Union[List[str], None] = None):
        self._df = df
        self._name = name
        self._class_names = class_names
        self._data = None
        self._fig = self.get_fig()

    @property
    def figure(self):
        &#34;&#34;&#34;Returns the matplotlib figure.&#34;&#34;&#34;
        return self._fig

    @property
    def figure_name(self):
        &#34;&#34;&#34;Returns the name of the figure.&#34;&#34;&#34;
        return self._name

    @abstractmethod
    def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
        &#34;Creates matplotlib figure.&#34;

    def save_fig(self, path: str, format: str = &#39;png&#39;):
        &#34;&#34;&#34;Saves the figure to the specified path.&#34;&#34;&#34;
        self._fig.savefig(os.path.join(path, self._name + f&#34;.{format}&#34;), dpi=300, bbox_inches=&#39;tight&#39;)

    def save_data(self, path: str):
        &#34;&#34;&#34;Saves the data to the specified path as a csv file.&#34;&#34;&#34;
        if self._data is None:
            return
        self._data.to_csv(os.path.join(path, self._name + &#34;.csv&#34;))

    def to_tensorboard(self, path: str):
        &#34;&#34;&#34;Saves the figure to tensorboard.&#34;&#34;&#34;
        with tf.summary.create_file_writer(path).as_default():
            tf.summary.image(self._name, self._fig_to_image(self._fig), step=0)

    def _fig_to_image(self, figure):
        &#34;&#34;&#34;
        Converts the matplotlib plot specified by &#39;figure&#39; to a PNG image and
        returns it. The supplied figure is closed and inaccessible after this call.
        &#34;&#34;&#34;
        buf = BytesIO()

        # Use plt.savefig to save the plot to a PNG in memory.
        figure.savefig(buf, format=&#39;png&#39;)

        # Closing the figure prevents it from being displayed directly inside
        # the notebook.
        # plt.close(figure)
        buf.seek(0)
        # Use tf.image.decode_png to convert the PNG buffer
        # to a TF image. Make sure you use 4 channels.
        image = tf.image.decode_png(buf.getvalue(), channels=4)
        # Use tf.expand_dims to add the batch dimension
        image = tf.expand_dims(image, 0)
        return image


class ValidationROC(ValidationFigure):
    &#34;&#34;&#34;Class for plotting the ROC curve.
    The ROC curve is calculated using the `sklearn.metrics.roc_curve` function.
    &#34;&#34;&#34;

    def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
        fp, tp, th = roc_curve(self._df[&#39;label&#39;].values, self._df[&#39;score&#39;].values)
        self._data = pd.DataFrame({&#39;FPR&#39;: fp, &#39;TPR&#39;: tp, &#39;threshold&#39;: th})
        auc_score = auc(fp, tp)

        if fig is None:
            fig = plt.figure(figsize=(8, 8))
        sns.lineplot(x=100 * fp, y=100 * tp, label=f&#39;AUC = {auc_score:.3f}&#39;, linewidth=2)
        sns.lineplot(x=[0, 50, 100], y=[0, 50, 100], label=f&#39;Random&#39;,
                     linewidth=1, linestyle=&#39;--&#39;, color=&#39;darkred&#39;, alpha=0.5)
        plt.plot([0, 0, 100], [0, 100, 100], color=&#39;darkgreen&#39;, linestyle=&#39;-.&#39;, label=&#39;Ideal&#39;, alpha=0.5)
        plt.xlabel(&#39;False positives [%]&#39;)
        plt.ylabel(&#39;True positives [%]&#39;)
        plt.grid(True)
        plt.legend()
        ax = plt.gca()
        ax.set_aspect(&#39;equal&#39;)
        return fig


class ValidationCM(ValidationFigure):
    &#34;&#34;&#34;Plots the confusion matrix.&#34;&#34;&#34;

    def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
        cm = confusion_matrix(self._df[&#39;label&#39;].values, self._df[&#39;prediction&#39;].values)
        if fig is None:
            fig = plt.figure(figsize=(6, 6))

        cm = np.around(cm.astype(&#39;float&#39;) / cm.sum(axis=1)[:, np.newaxis] * 1000, decimals=0).astype(int)
        df_cm = pd.DataFrame(cm, index=self._class_names, columns=self._class_names)
        self._data = df_cm
        sns.heatmap(df_cm, annot=True, fmt=&#39;4d&#39;, cmap=plt.cm.Blues, cbar=False)
        plt.title(&#34;Confusion matrix&#34;)
        plt.ylabel(&#39;True label&#39;)
        plt.xlabel(&#39;Predicted label&#39;)
        return fig


class ValidationScoreHistogram(ValidationFigure):
    &#34;&#34;&#34;Plots the output scores of the model, colored by the truth label.&#34;&#34;&#34;

    def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
        if fig is None:
            fig = plt.figure(figsize=(8, 8))
        self._data = self._df[[&#39;score&#39;, &#39;Truth Label&#39;]]
        ax = sns.histplot(data=self._df, x=&#39;score&#39;, hue=&#39;Truth Label&#39;,
                          palette=&#39;Set1&#39;, stat=&#39;count&#39;, element=&#34;step&#34;, fill=True,
                          hue_order=[&#39;quark&#39;, &#39;gluon&#39;],)
        sns.move_legend(ax, &#39;upper center&#39;)
        plt.xlabel(&#39;Score&#39;)
        return fig


class ValidationLabelHistogram(ValidationFigure):
    &#34;&#34;&#34;Plots the predicted labels of the model, colored by the truth label.
    This is usefull to see if the model is biased towards one class.
    &#34;&#34;&#34;

    def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
        if fig is None:
            fig = plt.figure(figsize=(8, 8))
        self._data = self._df[[&#39;Truth Label&#39;, &#39;named_prediction&#39;]]
        sns.histplot(self._df, x=&#39;named_prediction&#39;, hue=&#39;Truth Label&#39;,
                     stat=&#39;count&#39;, multiple=&#39;stack&#39;, hue_order=[&#39;quark&#39;, &#39;gluon&#39;],
                     palette=&#39;Set1&#39;)
        plt.xlabel(&#39;Predicted Tag&#39;)
        return fig


def plot_validation_figs(df: pd.DataFrame, logdir: str, log: Logger, formats: List[str] = [&#39;jpg&#39;, &#39;pdf&#39;]):
    &#34;&#34;&#34;Plots the validation figures and saves them to disk.
    Args:
        df (pd.DataFrame): The dataframe containing the truth lables, the model output scores and the predictions.
        logdir (str): The directory where the figures are saved.
        log (Logger): The logger.
        formats (list, optional): The formats in which the figures are saved. Defaults to [&#39;jpg&#39;, &#39;pdf&#39;].

    &#34;&#34;&#34;
    base_path = os.path.join(logdir, &#34;figs&#34;)
    tb_base_path = os.path.join(logdir, &#34;plots&#34;)
    csv_path = os.path.join(base_path, &#39;csv&#39;)
    os.makedirs(base_path, exist_ok=True)
    os.makedirs(tb_base_path, exist_ok=True)
    os.makedirs(csv_path, exist_ok=True)
    format_path = []
    for format in formats:
        format_path.append(os.path.join(base_path, format))
        os.makedirs(format_path[-1], exist_ok=True)

    figure_classes = [ValidationROC, ValidationCM, ValidationScoreHistogram, ValidationLabelHistogram]
    figure_names = [&#39;roc&#39;, &#39;confusion_matrix&#39;, &#39;score_hist&#39;, &#39;prediction_hist&#39;]

    for validation_fig, name in zip(figure_classes, figure_names):
        log.info(f&#34;Generating figure {name}&#34;)
        val_fig = validation_fig(df, name, [&#39;gluon&#39;, &#39;quark&#39;])
        for fmt, path in zip(formats, format_path):
            val_fig.save_fig(path, fmt)
        val_fig.save_data(csv_path)
        val_fig.to_tensorboard(tb_base_path)
    plt.close(&#39;all&#39;)


def plot_metrics_per_cut(df: pd.DataFrame, logdir: str, log: Logger, formats=[&#39;png&#39;, &#39;pdf&#39;]):
    &#34;&#34;&#34;Plots the metrics for different cuts and saves them to disk.

    Args:
        df (pd.DataFrame): dataframe containing the metrics for different cuts. 
        logdir (str): The directory where the figures are saved.
        log (Logger): The logger.
        formats (list, optional): The formats in which the figures are saved. Defaults to [&#39;jpg&#39;, &#39;pdf&#39;].
    &#34;&#34;&#34;
    base_path = os.path.join(logdir, &#34;metrics&#34;)
    os.makedirs(base_path, exist_ok=True)
    format_path = []
    for format in formats:
        format_path.append(os.path.join(base_path, format))
        os.makedirs(format_path[-1], exist_ok=True)

    for metric in df.columns:
        if metric == &#39;cut&#39;:
            continue
        log.info(f&#34;Plotting {metric} for cuts&#34;)
        sns.pointplot(x=&#39;cut&#39;, y=metric, data=df, join=False)
        plt.xlabel(&#39;Cut&#39;)
        plt.ylabel(str(metric))
        for fmt, path in zip(formats, format_path):
            plt.savefig(os.path.join(path, f&#39;{metric}.{fmt}&#39;))
        plt.close()


def plot_train_history(data: List[float], logdir: str, name: str, epochs: int):
    &#34;&#34;&#34;Plots the training history and saves it to disk.

    Args:
        data (list): The metric values as a function of the epoch.
        logdir (str): The directory where the figures are saved.
        name (str): The name of the metric.
        epochs (int): The number of epochs.
    &#34;&#34;&#34;
    fig = plt.figure(figsize=(10, 5))
    g = sns.lineplot(data=data, linewidth=2.5, palette=&#39;husl&#39;)
    g.set(xlabel=&#39;Epoch&#39;, ylabel=name)
    g.set_xticks(range(epochs))
    g.set_xticklabels(range(1, epochs + 1))
    plt.grid(True)
    fig.savefig(f&#39;{logdir}/{name}.png&#39;)
    plt.close()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="jidenn.evaluation.plotter.plot_metrics_per_cut"><code class="name flex">
<span>def <span class="ident">plot_metrics_per_cut</span></span>(<span>df:Â pandas.core.frame.DataFrame, logdir:Â str, log:Â logging.Logger, formats=['png', 'pdf'])</span>
</code></dt>
<dd>
<div class="desc"><p>Plots the metrics for different cuts and saves them to disk.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>df</code></strong> :&ensp;<code>pd.DataFrame</code></dt>
<dd>dataframe containing the metrics for different cuts. </dd>
<dt><strong><code>logdir</code></strong> :&ensp;<code>str</code></dt>
<dd>The directory where the figures are saved.</dd>
<dt><strong><code>log</code></strong> :&ensp;<code>Logger</code></dt>
<dd>The logger.</dd>
<dt><strong><code>formats</code></strong> :&ensp;<code>list</code>, optional</dt>
<dd>The formats in which the figures are saved. Defaults to ['jpg', 'pdf'].</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_metrics_per_cut(df: pd.DataFrame, logdir: str, log: Logger, formats=[&#39;png&#39;, &#39;pdf&#39;]):
    &#34;&#34;&#34;Plots the metrics for different cuts and saves them to disk.

    Args:
        df (pd.DataFrame): dataframe containing the metrics for different cuts. 
        logdir (str): The directory where the figures are saved.
        log (Logger): The logger.
        formats (list, optional): The formats in which the figures are saved. Defaults to [&#39;jpg&#39;, &#39;pdf&#39;].
    &#34;&#34;&#34;
    base_path = os.path.join(logdir, &#34;metrics&#34;)
    os.makedirs(base_path, exist_ok=True)
    format_path = []
    for format in formats:
        format_path.append(os.path.join(base_path, format))
        os.makedirs(format_path[-1], exist_ok=True)

    for metric in df.columns:
        if metric == &#39;cut&#39;:
            continue
        log.info(f&#34;Plotting {metric} for cuts&#34;)
        sns.pointplot(x=&#39;cut&#39;, y=metric, data=df, join=False)
        plt.xlabel(&#39;Cut&#39;)
        plt.ylabel(str(metric))
        for fmt, path in zip(formats, format_path):
            plt.savefig(os.path.join(path, f&#39;{metric}.{fmt}&#39;))
        plt.close()</code></pre>
</details>
</dd>
<dt id="jidenn.evaluation.plotter.plot_train_history"><code class="name flex">
<span>def <span class="ident">plot_train_history</span></span>(<span>data:Â List[float], logdir:Â str, name:Â str, epochs:Â int)</span>
</code></dt>
<dd>
<div class="desc"><p>Plots the training history and saves it to disk.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>data</code></strong> :&ensp;<code>list</code></dt>
<dd>The metric values as a function of the epoch.</dd>
<dt><strong><code>logdir</code></strong> :&ensp;<code>str</code></dt>
<dd>The directory where the figures are saved.</dd>
<dt><strong><code>name</code></strong> :&ensp;<code>str</code></dt>
<dd>The name of the metric.</dd>
<dt><strong><code>epochs</code></strong> :&ensp;<code>int</code></dt>
<dd>The number of epochs.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_train_history(data: List[float], logdir: str, name: str, epochs: int):
    &#34;&#34;&#34;Plots the training history and saves it to disk.

    Args:
        data (list): The metric values as a function of the epoch.
        logdir (str): The directory where the figures are saved.
        name (str): The name of the metric.
        epochs (int): The number of epochs.
    &#34;&#34;&#34;
    fig = plt.figure(figsize=(10, 5))
    g = sns.lineplot(data=data, linewidth=2.5, palette=&#39;husl&#39;)
    g.set(xlabel=&#39;Epoch&#39;, ylabel=name)
    g.set_xticks(range(epochs))
    g.set_xticklabels(range(1, epochs + 1))
    plt.grid(True)
    fig.savefig(f&#39;{logdir}/{name}.png&#39;)
    plt.close()</code></pre>
</details>
</dd>
<dt id="jidenn.evaluation.plotter.plot_validation_figs"><code class="name flex">
<span>def <span class="ident">plot_validation_figs</span></span>(<span>df:Â pandas.core.frame.DataFrame, logdir:Â str, log:Â logging.Logger, formats:Â List[str]Â =Â ['jpg', 'pdf'])</span>
</code></dt>
<dd>
<div class="desc"><p>Plots the validation figures and saves them to disk.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>df</code></strong> :&ensp;<code>pd.DataFrame</code></dt>
<dd>The dataframe containing the truth lables, the model output scores and the predictions.</dd>
<dt><strong><code>logdir</code></strong> :&ensp;<code>str</code></dt>
<dd>The directory where the figures are saved.</dd>
<dt><strong><code>log</code></strong> :&ensp;<code>Logger</code></dt>
<dd>The logger.</dd>
<dt><strong><code>formats</code></strong> :&ensp;<code>list</code>, optional</dt>
<dd>The formats in which the figures are saved. Defaults to ['jpg', 'pdf'].</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def plot_validation_figs(df: pd.DataFrame, logdir: str, log: Logger, formats: List[str] = [&#39;jpg&#39;, &#39;pdf&#39;]):
    &#34;&#34;&#34;Plots the validation figures and saves them to disk.
    Args:
        df (pd.DataFrame): The dataframe containing the truth lables, the model output scores and the predictions.
        logdir (str): The directory where the figures are saved.
        log (Logger): The logger.
        formats (list, optional): The formats in which the figures are saved. Defaults to [&#39;jpg&#39;, &#39;pdf&#39;].

    &#34;&#34;&#34;
    base_path = os.path.join(logdir, &#34;figs&#34;)
    tb_base_path = os.path.join(logdir, &#34;plots&#34;)
    csv_path = os.path.join(base_path, &#39;csv&#39;)
    os.makedirs(base_path, exist_ok=True)
    os.makedirs(tb_base_path, exist_ok=True)
    os.makedirs(csv_path, exist_ok=True)
    format_path = []
    for format in formats:
        format_path.append(os.path.join(base_path, format))
        os.makedirs(format_path[-1], exist_ok=True)

    figure_classes = [ValidationROC, ValidationCM, ValidationScoreHistogram, ValidationLabelHistogram]
    figure_names = [&#39;roc&#39;, &#39;confusion_matrix&#39;, &#39;score_hist&#39;, &#39;prediction_hist&#39;]

    for validation_fig, name in zip(figure_classes, figure_names):
        log.info(f&#34;Generating figure {name}&#34;)
        val_fig = validation_fig(df, name, [&#39;gluon&#39;, &#39;quark&#39;])
        for fmt, path in zip(formats, format_path):
            val_fig.save_fig(path, fmt)
        val_fig.save_data(csv_path)
        val_fig.to_tensorboard(tb_base_path)
    plt.close(&#39;all&#39;)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationCM"><code class="flex name class">
<span>class <span class="ident">ValidationCM</span></span>
<span>(</span><span>df:Â pandas.core.frame.DataFrame, name:Â strÂ =Â 'fig', class_names:Â Optional[List[str]]Â =Â None)</span>
</code></dt>
<dd>
<div class="desc"><p>Plots the confusion matrix.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ValidationCM(ValidationFigure):
    &#34;&#34;&#34;Plots the confusion matrix.&#34;&#34;&#34;

    def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
        cm = confusion_matrix(self._df[&#39;label&#39;].values, self._df[&#39;prediction&#39;].values)
        if fig is None:
            fig = plt.figure(figsize=(6, 6))

        cm = np.around(cm.astype(&#39;float&#39;) / cm.sum(axis=1)[:, np.newaxis] * 1000, decimals=0).astype(int)
        df_cm = pd.DataFrame(cm, index=self._class_names, columns=self._class_names)
        self._data = df_cm
        sns.heatmap(df_cm, annot=True, fmt=&#39;4d&#39;, cmap=plt.cm.Blues, cbar=False)
        plt.title(&#34;Confusion matrix&#34;)
        plt.ylabel(&#39;True label&#39;)
        plt.xlabel(&#39;Predicted label&#39;)
        return fig</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationCM.figure"><code class="name">var <span class="ident">figure</span></code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.figure" href="#jidenn.evaluation.plotter.ValidationFigure.figure">figure</a></code>
</p>
<div class="desc inherited"><p>Returns the matplotlib figure.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationCM.figure_name"><code class="name">var <span class="ident">figure_name</span></code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.figure_name" href="#jidenn.evaluation.plotter.ValidationFigure.figure_name">figure_name</a></code>
</p>
<div class="desc inherited"><p>Returns the name of the figure.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationCM.get_fig"><code class="name flex">
<span>def <span class="ident">get_fig</span></span>(<span>self, fig:Â Optional[matplotlib.figure.Figure]Â =Â None) â€‘>Â matplotlib.figure.Figure</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.get_fig" href="#jidenn.evaluation.plotter.ValidationFigure.get_fig">get_fig</a></code>
</p>
<div class="desc inherited"><p>Creates matplotlib figure.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
    cm = confusion_matrix(self._df[&#39;label&#39;].values, self._df[&#39;prediction&#39;].values)
    if fig is None:
        fig = plt.figure(figsize=(6, 6))

    cm = np.around(cm.astype(&#39;float&#39;) / cm.sum(axis=1)[:, np.newaxis] * 1000, decimals=0).astype(int)
    df_cm = pd.DataFrame(cm, index=self._class_names, columns=self._class_names)
    self._data = df_cm
    sns.heatmap(df_cm, annot=True, fmt=&#39;4d&#39;, cmap=plt.cm.Blues, cbar=False)
    plt.title(&#34;Confusion matrix&#34;)
    plt.ylabel(&#39;True label&#39;)
    plt.xlabel(&#39;Predicted label&#39;)
    return fig</code></pre>
</details>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationCM.save_data"><code class="name flex">
<span>def <span class="ident">save_data</span></span>(<span>self, path:Â str)</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.save_data" href="#jidenn.evaluation.plotter.ValidationFigure.save_data">save_data</a></code>
</p>
<div class="desc inherited"><p>Saves the data to the specified path as a csv file.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationCM.save_fig"><code class="name flex">
<span>def <span class="ident">save_fig</span></span>(<span>self, path:Â str, format:Â strÂ =Â 'png')</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.save_fig" href="#jidenn.evaluation.plotter.ValidationFigure.save_fig">save_fig</a></code>
</p>
<div class="desc inherited"><p>Saves the figure to the specified path.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationCM.to_tensorboard"><code class="name flex">
<span>def <span class="ident">to_tensorboard</span></span>(<span>self, path:Â str)</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.to_tensorboard" href="#jidenn.evaluation.plotter.ValidationFigure.to_tensorboard">to_tensorboard</a></code>
</p>
<div class="desc inherited"><p>Saves the figure to tensorboard.</p></div>
</dd>
</dl>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationFigure"><code class="flex name class">
<span>class <span class="ident">ValidationFigure</span></span>
<span>(</span><span>df:Â pandas.core.frame.DataFrame, name:Â strÂ =Â 'fig', class_names:Â Optional[List[str]]Â =Â None)</span>
</code></dt>
<dd>
<div class="desc"><p>Base class for validation figures.</p>
<p>Only the <code>get_fig</code> method needs to be implemented.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>df</code></strong> :&ensp;<code>pd.DataFrame</code></dt>
<dd>The dataframe containing the data.</dd>
<dt><strong><code>name</code></strong> :&ensp;<code>str</code>, optional</dt>
<dd>The name of the figure. Defaults to 'fig'.</dd>
<dt><strong><code>class_names</code></strong> :&ensp;<code>List[str]</code>, optional</dt>
<dd>The names of the classes. Defaults to None.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ValidationFigure:
    &#34;&#34;&#34;Base class for validation figures.

    Only the `get_fig` method needs to be implemented.

    Args:
        df (pd.DataFrame): The dataframe containing the data.
        name (str, optional): The name of the figure. Defaults to &#39;fig&#39;.
        class_names (List[str], optional): The names of the classes. Defaults to None.

    &#34;&#34;&#34;

    def __init__(self, df: pd.DataFrame, name: str = &#39;fig&#39;, class_names: Union[List[str], None] = None):
        self._df = df
        self._name = name
        self._class_names = class_names
        self._data = None
        self._fig = self.get_fig()

    @property
    def figure(self):
        &#34;&#34;&#34;Returns the matplotlib figure.&#34;&#34;&#34;
        return self._fig

    @property
    def figure_name(self):
        &#34;&#34;&#34;Returns the name of the figure.&#34;&#34;&#34;
        return self._name

    @abstractmethod
    def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
        &#34;Creates matplotlib figure.&#34;

    def save_fig(self, path: str, format: str = &#39;png&#39;):
        &#34;&#34;&#34;Saves the figure to the specified path.&#34;&#34;&#34;
        self._fig.savefig(os.path.join(path, self._name + f&#34;.{format}&#34;), dpi=300, bbox_inches=&#39;tight&#39;)

    def save_data(self, path: str):
        &#34;&#34;&#34;Saves the data to the specified path as a csv file.&#34;&#34;&#34;
        if self._data is None:
            return
        self._data.to_csv(os.path.join(path, self._name + &#34;.csv&#34;))

    def to_tensorboard(self, path: str):
        &#34;&#34;&#34;Saves the figure to tensorboard.&#34;&#34;&#34;
        with tf.summary.create_file_writer(path).as_default():
            tf.summary.image(self._name, self._fig_to_image(self._fig), step=0)

    def _fig_to_image(self, figure):
        &#34;&#34;&#34;
        Converts the matplotlib plot specified by &#39;figure&#39; to a PNG image and
        returns it. The supplied figure is closed and inaccessible after this call.
        &#34;&#34;&#34;
        buf = BytesIO()

        # Use plt.savefig to save the plot to a PNG in memory.
        figure.savefig(buf, format=&#39;png&#39;)

        # Closing the figure prevents it from being displayed directly inside
        # the notebook.
        # plt.close(figure)
        buf.seek(0)
        # Use tf.image.decode_png to convert the PNG buffer
        # to a TF image. Make sure you use 4 channels.
        image = tf.image.decode_png(buf.getvalue(), channels=4)
        # Use tf.expand_dims to add the batch dimension
        image = tf.expand_dims(image, 0)
        return image</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="jidenn.evaluation.plotter.ValidationCM" href="#jidenn.evaluation.plotter.ValidationCM">ValidationCM</a></li>
<li><a title="jidenn.evaluation.plotter.ValidationLabelHistogram" href="#jidenn.evaluation.plotter.ValidationLabelHistogram">ValidationLabelHistogram</a></li>
<li><a title="jidenn.evaluation.plotter.ValidationROC" href="#jidenn.evaluation.plotter.ValidationROC">ValidationROC</a></li>
<li><a title="jidenn.evaluation.plotter.ValidationScoreHistogram" href="#jidenn.evaluation.plotter.ValidationScoreHistogram">ValidationScoreHistogram</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationFigure.figure"><code class="name">var <span class="ident">figure</span></code></dt>
<dd>
<div class="desc"><p>Returns the matplotlib figure.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def figure(self):
    &#34;&#34;&#34;Returns the matplotlib figure.&#34;&#34;&#34;
    return self._fig</code></pre>
</details>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationFigure.figure_name"><code class="name">var <span class="ident">figure_name</span></code></dt>
<dd>
<div class="desc"><p>Returns the name of the figure.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def figure_name(self):
    &#34;&#34;&#34;Returns the name of the figure.&#34;&#34;&#34;
    return self._name</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationFigure.get_fig"><code class="name flex">
<span>def <span class="ident">get_fig</span></span>(<span>self, fig:Â Optional[matplotlib.figure.Figure]Â =Â None) â€‘>Â matplotlib.figure.Figure</span>
</code></dt>
<dd>
<div class="desc"><p>Creates matplotlib figure.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@abstractmethod
def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
    &#34;Creates matplotlib figure.&#34;</code></pre>
</details>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationFigure.save_data"><code class="name flex">
<span>def <span class="ident">save_data</span></span>(<span>self, path:Â str)</span>
</code></dt>
<dd>
<div class="desc"><p>Saves the data to the specified path as a csv file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_data(self, path: str):
    &#34;&#34;&#34;Saves the data to the specified path as a csv file.&#34;&#34;&#34;
    if self._data is None:
        return
    self._data.to_csv(os.path.join(path, self._name + &#34;.csv&#34;))</code></pre>
</details>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationFigure.save_fig"><code class="name flex">
<span>def <span class="ident">save_fig</span></span>(<span>self, path:Â str, format:Â strÂ =Â 'png')</span>
</code></dt>
<dd>
<div class="desc"><p>Saves the figure to the specified path.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_fig(self, path: str, format: str = &#39;png&#39;):
    &#34;&#34;&#34;Saves the figure to the specified path.&#34;&#34;&#34;
    self._fig.savefig(os.path.join(path, self._name + f&#34;.{format}&#34;), dpi=300, bbox_inches=&#39;tight&#39;)</code></pre>
</details>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationFigure.to_tensorboard"><code class="name flex">
<span>def <span class="ident">to_tensorboard</span></span>(<span>self, path:Â str)</span>
</code></dt>
<dd>
<div class="desc"><p>Saves the figure to tensorboard.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def to_tensorboard(self, path: str):
    &#34;&#34;&#34;Saves the figure to tensorboard.&#34;&#34;&#34;
    with tf.summary.create_file_writer(path).as_default():
        tf.summary.image(self._name, self._fig_to_image(self._fig), step=0)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationLabelHistogram"><code class="flex name class">
<span>class <span class="ident">ValidationLabelHistogram</span></span>
<span>(</span><span>df:Â pandas.core.frame.DataFrame, name:Â strÂ =Â 'fig', class_names:Â Optional[List[str]]Â =Â None)</span>
</code></dt>
<dd>
<div class="desc"><p>Plots the predicted labels of the model, colored by the truth label.
This is usefull to see if the model is biased towards one class.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ValidationLabelHistogram(ValidationFigure):
    &#34;&#34;&#34;Plots the predicted labels of the model, colored by the truth label.
    This is usefull to see if the model is biased towards one class.
    &#34;&#34;&#34;

    def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
        if fig is None:
            fig = plt.figure(figsize=(8, 8))
        self._data = self._df[[&#39;Truth Label&#39;, &#39;named_prediction&#39;]]
        sns.histplot(self._df, x=&#39;named_prediction&#39;, hue=&#39;Truth Label&#39;,
                     stat=&#39;count&#39;, multiple=&#39;stack&#39;, hue_order=[&#39;quark&#39;, &#39;gluon&#39;],
                     palette=&#39;Set1&#39;)
        plt.xlabel(&#39;Predicted Tag&#39;)
        return fig</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationLabelHistogram.figure"><code class="name">var <span class="ident">figure</span></code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.figure" href="#jidenn.evaluation.plotter.ValidationFigure.figure">figure</a></code>
</p>
<div class="desc inherited"><p>Returns the matplotlib figure.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationLabelHistogram.figure_name"><code class="name">var <span class="ident">figure_name</span></code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.figure_name" href="#jidenn.evaluation.plotter.ValidationFigure.figure_name">figure_name</a></code>
</p>
<div class="desc inherited"><p>Returns the name of the figure.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationLabelHistogram.get_fig"><code class="name flex">
<span>def <span class="ident">get_fig</span></span>(<span>self, fig:Â Optional[matplotlib.figure.Figure]Â =Â None) â€‘>Â matplotlib.figure.Figure</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.get_fig" href="#jidenn.evaluation.plotter.ValidationFigure.get_fig">get_fig</a></code>
</p>
<div class="desc inherited"><p>Creates matplotlib figure.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
    if fig is None:
        fig = plt.figure(figsize=(8, 8))
    self._data = self._df[[&#39;Truth Label&#39;, &#39;named_prediction&#39;]]
    sns.histplot(self._df, x=&#39;named_prediction&#39;, hue=&#39;Truth Label&#39;,
                 stat=&#39;count&#39;, multiple=&#39;stack&#39;, hue_order=[&#39;quark&#39;, &#39;gluon&#39;],
                 palette=&#39;Set1&#39;)
    plt.xlabel(&#39;Predicted Tag&#39;)
    return fig</code></pre>
</details>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationLabelHistogram.save_data"><code class="name flex">
<span>def <span class="ident">save_data</span></span>(<span>self, path:Â str)</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.save_data" href="#jidenn.evaluation.plotter.ValidationFigure.save_data">save_data</a></code>
</p>
<div class="desc inherited"><p>Saves the data to the specified path as a csv file.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationLabelHistogram.save_fig"><code class="name flex">
<span>def <span class="ident">save_fig</span></span>(<span>self, path:Â str, format:Â strÂ =Â 'png')</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.save_fig" href="#jidenn.evaluation.plotter.ValidationFigure.save_fig">save_fig</a></code>
</p>
<div class="desc inherited"><p>Saves the figure to the specified path.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationLabelHistogram.to_tensorboard"><code class="name flex">
<span>def <span class="ident">to_tensorboard</span></span>(<span>self, path:Â str)</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.to_tensorboard" href="#jidenn.evaluation.plotter.ValidationFigure.to_tensorboard">to_tensorboard</a></code>
</p>
<div class="desc inherited"><p>Saves the figure to tensorboard.</p></div>
</dd>
</dl>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationROC"><code class="flex name class">
<span>class <span class="ident">ValidationROC</span></span>
<span>(</span><span>df:Â pandas.core.frame.DataFrame, name:Â strÂ =Â 'fig', class_names:Â Optional[List[str]]Â =Â None)</span>
</code></dt>
<dd>
<div class="desc"><p>Class for plotting the ROC curve.
The ROC curve is calculated using the <code>sklearn.metrics.roc_curve</code> function.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ValidationROC(ValidationFigure):
    &#34;&#34;&#34;Class for plotting the ROC curve.
    The ROC curve is calculated using the `sklearn.metrics.roc_curve` function.
    &#34;&#34;&#34;

    def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
        fp, tp, th = roc_curve(self._df[&#39;label&#39;].values, self._df[&#39;score&#39;].values)
        self._data = pd.DataFrame({&#39;FPR&#39;: fp, &#39;TPR&#39;: tp, &#39;threshold&#39;: th})
        auc_score = auc(fp, tp)

        if fig is None:
            fig = plt.figure(figsize=(8, 8))
        sns.lineplot(x=100 * fp, y=100 * tp, label=f&#39;AUC = {auc_score:.3f}&#39;, linewidth=2)
        sns.lineplot(x=[0, 50, 100], y=[0, 50, 100], label=f&#39;Random&#39;,
                     linewidth=1, linestyle=&#39;--&#39;, color=&#39;darkred&#39;, alpha=0.5)
        plt.plot([0, 0, 100], [0, 100, 100], color=&#39;darkgreen&#39;, linestyle=&#39;-.&#39;, label=&#39;Ideal&#39;, alpha=0.5)
        plt.xlabel(&#39;False positives [%]&#39;)
        plt.ylabel(&#39;True positives [%]&#39;)
        plt.grid(True)
        plt.legend()
        ax = plt.gca()
        ax.set_aspect(&#39;equal&#39;)
        return fig</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationROC.figure"><code class="name">var <span class="ident">figure</span></code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.figure" href="#jidenn.evaluation.plotter.ValidationFigure.figure">figure</a></code>
</p>
<div class="desc inherited"><p>Returns the matplotlib figure.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationROC.figure_name"><code class="name">var <span class="ident">figure_name</span></code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.figure_name" href="#jidenn.evaluation.plotter.ValidationFigure.figure_name">figure_name</a></code>
</p>
<div class="desc inherited"><p>Returns the name of the figure.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationROC.get_fig"><code class="name flex">
<span>def <span class="ident">get_fig</span></span>(<span>self, fig:Â Optional[matplotlib.figure.Figure]Â =Â None) â€‘>Â matplotlib.figure.Figure</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.get_fig" href="#jidenn.evaluation.plotter.ValidationFigure.get_fig">get_fig</a></code>
</p>
<div class="desc inherited"><p>Creates matplotlib figure.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
    fp, tp, th = roc_curve(self._df[&#39;label&#39;].values, self._df[&#39;score&#39;].values)
    self._data = pd.DataFrame({&#39;FPR&#39;: fp, &#39;TPR&#39;: tp, &#39;threshold&#39;: th})
    auc_score = auc(fp, tp)

    if fig is None:
        fig = plt.figure(figsize=(8, 8))
    sns.lineplot(x=100 * fp, y=100 * tp, label=f&#39;AUC = {auc_score:.3f}&#39;, linewidth=2)
    sns.lineplot(x=[0, 50, 100], y=[0, 50, 100], label=f&#39;Random&#39;,
                 linewidth=1, linestyle=&#39;--&#39;, color=&#39;darkred&#39;, alpha=0.5)
    plt.plot([0, 0, 100], [0, 100, 100], color=&#39;darkgreen&#39;, linestyle=&#39;-.&#39;, label=&#39;Ideal&#39;, alpha=0.5)
    plt.xlabel(&#39;False positives [%]&#39;)
    plt.ylabel(&#39;True positives [%]&#39;)
    plt.grid(True)
    plt.legend()
    ax = plt.gca()
    ax.set_aspect(&#39;equal&#39;)
    return fig</code></pre>
</details>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationROC.save_data"><code class="name flex">
<span>def <span class="ident">save_data</span></span>(<span>self, path:Â str)</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.save_data" href="#jidenn.evaluation.plotter.ValidationFigure.save_data">save_data</a></code>
</p>
<div class="desc inherited"><p>Saves the data to the specified path as a csv file.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationROC.save_fig"><code class="name flex">
<span>def <span class="ident">save_fig</span></span>(<span>self, path:Â str, format:Â strÂ =Â 'png')</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.save_fig" href="#jidenn.evaluation.plotter.ValidationFigure.save_fig">save_fig</a></code>
</p>
<div class="desc inherited"><p>Saves the figure to the specified path.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationROC.to_tensorboard"><code class="name flex">
<span>def <span class="ident">to_tensorboard</span></span>(<span>self, path:Â str)</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.to_tensorboard" href="#jidenn.evaluation.plotter.ValidationFigure.to_tensorboard">to_tensorboard</a></code>
</p>
<div class="desc inherited"><p>Saves the figure to tensorboard.</p></div>
</dd>
</dl>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationScoreHistogram"><code class="flex name class">
<span>class <span class="ident">ValidationScoreHistogram</span></span>
<span>(</span><span>df:Â pandas.core.frame.DataFrame, name:Â strÂ =Â 'fig', class_names:Â Optional[List[str]]Â =Â None)</span>
</code></dt>
<dd>
<div class="desc"><p>Plots the output scores of the model, colored by the truth label.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ValidationScoreHistogram(ValidationFigure):
    &#34;&#34;&#34;Plots the output scores of the model, colored by the truth label.&#34;&#34;&#34;

    def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
        if fig is None:
            fig = plt.figure(figsize=(8, 8))
        self._data = self._df[[&#39;score&#39;, &#39;Truth Label&#39;]]
        ax = sns.histplot(data=self._df, x=&#39;score&#39;, hue=&#39;Truth Label&#39;,
                          palette=&#39;Set1&#39;, stat=&#39;count&#39;, element=&#34;step&#34;, fill=True,
                          hue_order=[&#39;quark&#39;, &#39;gluon&#39;],)
        sns.move_legend(ax, &#39;upper center&#39;)
        plt.xlabel(&#39;Score&#39;)
        return fig</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationScoreHistogram.figure"><code class="name">var <span class="ident">figure</span></code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.figure" href="#jidenn.evaluation.plotter.ValidationFigure.figure">figure</a></code>
</p>
<div class="desc inherited"><p>Returns the matplotlib figure.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationScoreHistogram.figure_name"><code class="name">var <span class="ident">figure_name</span></code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.figure_name" href="#jidenn.evaluation.plotter.ValidationFigure.figure_name">figure_name</a></code>
</p>
<div class="desc inherited"><p>Returns the name of the figure.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="jidenn.evaluation.plotter.ValidationScoreHistogram.get_fig"><code class="name flex">
<span>def <span class="ident">get_fig</span></span>(<span>self, fig:Â Optional[matplotlib.figure.Figure]Â =Â None) â€‘>Â matplotlib.figure.Figure</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.get_fig" href="#jidenn.evaluation.plotter.ValidationFigure.get_fig">get_fig</a></code>
</p>
<div class="desc inherited"><p>Creates matplotlib figure.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_fig(self, fig: Union[plt.Figure, None] = None) -&gt; plt.Figure:
    if fig is None:
        fig = plt.figure(figsize=(8, 8))
    self._data = self._df[[&#39;score&#39;, &#39;Truth Label&#39;]]
    ax = sns.histplot(data=self._df, x=&#39;score&#39;, hue=&#39;Truth Label&#39;,
                      palette=&#39;Set1&#39;, stat=&#39;count&#39;, element=&#34;step&#34;, fill=True,
                      hue_order=[&#39;quark&#39;, &#39;gluon&#39;],)
    sns.move_legend(ax, &#39;upper center&#39;)
    plt.xlabel(&#39;Score&#39;)
    return fig</code></pre>
</details>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationScoreHistogram.save_data"><code class="name flex">
<span>def <span class="ident">save_data</span></span>(<span>self, path:Â str)</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.save_data" href="#jidenn.evaluation.plotter.ValidationFigure.save_data">save_data</a></code>
</p>
<div class="desc inherited"><p>Saves the data to the specified path as a csv file.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationScoreHistogram.save_fig"><code class="name flex">
<span>def <span class="ident">save_fig</span></span>(<span>self, path:Â str, format:Â strÂ =Â 'png')</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.save_fig" href="#jidenn.evaluation.plotter.ValidationFigure.save_fig">save_fig</a></code>
</p>
<div class="desc inherited"><p>Saves the figure to the specified path.</p></div>
</dd>
<dt id="jidenn.evaluation.plotter.ValidationScoreHistogram.to_tensorboard"><code class="name flex">
<span>def <span class="ident">to_tensorboard</span></span>(<span>self, path:Â str)</span>
</code></dt>
<dd>
<p class="inheritance">
<em>Inherited from:</em>
<code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code>.<code><a title="jidenn.evaluation.plotter.ValidationFigure.to_tensorboard" href="#jidenn.evaluation.plotter.ValidationFigure.to_tensorboard">to_tensorboard</a></code>
</p>
<div class="desc inherited"><p>Saves the figure to tensorboard.</p></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="jidenn.evaluation" href="index.html">jidenn.evaluation</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="jidenn.evaluation.plotter.plot_metrics_per_cut" href="#jidenn.evaluation.plotter.plot_metrics_per_cut">plot_metrics_per_cut</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.plot_train_history" href="#jidenn.evaluation.plotter.plot_train_history">plot_train_history</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.plot_validation_figs" href="#jidenn.evaluation.plotter.plot_validation_figs">plot_validation_figs</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="jidenn.evaluation.plotter.ValidationCM" href="#jidenn.evaluation.plotter.ValidationCM">ValidationCM</a></code></h4>
<ul class="two-column">
<li><code><a title="jidenn.evaluation.plotter.ValidationCM.figure" href="#jidenn.evaluation.plotter.ValidationCM.figure">figure</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationCM.figure_name" href="#jidenn.evaluation.plotter.ValidationCM.figure_name">figure_name</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationCM.get_fig" href="#jidenn.evaluation.plotter.ValidationCM.get_fig">get_fig</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationCM.save_data" href="#jidenn.evaluation.plotter.ValidationCM.save_data">save_data</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationCM.save_fig" href="#jidenn.evaluation.plotter.ValidationCM.save_fig">save_fig</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationCM.to_tensorboard" href="#jidenn.evaluation.plotter.ValidationCM.to_tensorboard">to_tensorboard</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jidenn.evaluation.plotter.ValidationFigure" href="#jidenn.evaluation.plotter.ValidationFigure">ValidationFigure</a></code></h4>
<ul class="two-column">
<li><code><a title="jidenn.evaluation.plotter.ValidationFigure.figure" href="#jidenn.evaluation.plotter.ValidationFigure.figure">figure</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationFigure.figure_name" href="#jidenn.evaluation.plotter.ValidationFigure.figure_name">figure_name</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationFigure.get_fig" href="#jidenn.evaluation.plotter.ValidationFigure.get_fig">get_fig</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationFigure.save_data" href="#jidenn.evaluation.plotter.ValidationFigure.save_data">save_data</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationFigure.save_fig" href="#jidenn.evaluation.plotter.ValidationFigure.save_fig">save_fig</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationFigure.to_tensorboard" href="#jidenn.evaluation.plotter.ValidationFigure.to_tensorboard">to_tensorboard</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jidenn.evaluation.plotter.ValidationLabelHistogram" href="#jidenn.evaluation.plotter.ValidationLabelHistogram">ValidationLabelHistogram</a></code></h4>
<ul class="two-column">
<li><code><a title="jidenn.evaluation.plotter.ValidationLabelHistogram.figure" href="#jidenn.evaluation.plotter.ValidationLabelHistogram.figure">figure</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationLabelHistogram.figure_name" href="#jidenn.evaluation.plotter.ValidationLabelHistogram.figure_name">figure_name</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationLabelHistogram.get_fig" href="#jidenn.evaluation.plotter.ValidationLabelHistogram.get_fig">get_fig</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationLabelHistogram.save_data" href="#jidenn.evaluation.plotter.ValidationLabelHistogram.save_data">save_data</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationLabelHistogram.save_fig" href="#jidenn.evaluation.plotter.ValidationLabelHistogram.save_fig">save_fig</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationLabelHistogram.to_tensorboard" href="#jidenn.evaluation.plotter.ValidationLabelHistogram.to_tensorboard">to_tensorboard</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jidenn.evaluation.plotter.ValidationROC" href="#jidenn.evaluation.plotter.ValidationROC">ValidationROC</a></code></h4>
<ul class="two-column">
<li><code><a title="jidenn.evaluation.plotter.ValidationROC.figure" href="#jidenn.evaluation.plotter.ValidationROC.figure">figure</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationROC.figure_name" href="#jidenn.evaluation.plotter.ValidationROC.figure_name">figure_name</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationROC.get_fig" href="#jidenn.evaluation.plotter.ValidationROC.get_fig">get_fig</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationROC.save_data" href="#jidenn.evaluation.plotter.ValidationROC.save_data">save_data</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationROC.save_fig" href="#jidenn.evaluation.plotter.ValidationROC.save_fig">save_fig</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationROC.to_tensorboard" href="#jidenn.evaluation.plotter.ValidationROC.to_tensorboard">to_tensorboard</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jidenn.evaluation.plotter.ValidationScoreHistogram" href="#jidenn.evaluation.plotter.ValidationScoreHistogram">ValidationScoreHistogram</a></code></h4>
<ul class="two-column">
<li><code><a title="jidenn.evaluation.plotter.ValidationScoreHistogram.figure" href="#jidenn.evaluation.plotter.ValidationScoreHistogram.figure">figure</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationScoreHistogram.figure_name" href="#jidenn.evaluation.plotter.ValidationScoreHistogram.figure_name">figure_name</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationScoreHistogram.get_fig" href="#jidenn.evaluation.plotter.ValidationScoreHistogram.get_fig">get_fig</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationScoreHistogram.save_data" href="#jidenn.evaluation.plotter.ValidationScoreHistogram.save_data">save_data</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationScoreHistogram.save_fig" href="#jidenn.evaluation.plotter.ValidationScoreHistogram.save_fig">save_fig</a></code></li>
<li><code><a title="jidenn.evaluation.plotter.ValidationScoreHistogram.to_tensorboard" href="#jidenn.evaluation.plotter.ValidationScoreHistogram.to_tensorboard">to_tensorboard</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>